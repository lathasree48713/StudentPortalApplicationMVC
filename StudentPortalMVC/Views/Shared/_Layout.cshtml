@using Microsoft.AspNet.Identity @* Add this line for User.IsInRole() *@
@using Microsoft.AspNet.Identity.Owin @* Often useful for other Identity helpers *@

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>@ViewBag.Title - Student Portal</title> @* Added " - Student Portal" for consistency *@

    @* CSS Bundles *@
    @Styles.Render("~/Content/sbadminstyles")
    @Styles.Render("~/Content/css")
    @Styles.Render("~/Content/datatablescss") @* Simple DataTables CSS Bundle *@

    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script> @* Font Awesome for icons *@

</head>
<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="@Url.Action("Index", "Home")">Student Portal</a>

        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
        <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
            <div class="input-group">
                <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch" />
                <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
            </div>
        </form>

        @* Integrating the default MVC _LoginPartial for user authentication *@
        @Html.Partial("_LoginPartial")

    </nav>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>

                        @* Conditional Dashboard Link based on Role *@
                        @if (Request.IsAuthenticated)
                        {
                            if (User.IsInRole("Admin"))
                            {
                                @Html.ActionLink("Admin Dashboard", "Dashboard", "Admin", null, new { @class = "nav-link" })
                            }
                            else if (User.IsInRole("Student"))
                            {
                                @Html.ActionLink("Dashboard", "Index", "Home", null, new { @class = "nav-link" })
                            }
                            else
                            {
                                @* Fallback for other logged-in roles or if user has no specific role *@
                                @Html.ActionLink("Dashboard", "Index", "Home", null, new { @class = "nav-link" })
                            }
                        }
                        else
                        {
                            @* For unauthenticated users, show a general Home/Dashboard link *@
                            @Html.ActionLink("Home", "Index", "Home", null, new { @class = "nav-link" })
                        }

                        @* Student-Specific Features (Visible ONLY to Student Role) *@
                        @if (Request.IsAuthenticated && User.IsInRole("Student"))
                        {
                            <div class="sb-sidenav-menu-heading">Features</div>
                            @Html.ActionLink("Profile", "UserProfile", "Profile", null, new { @class = "nav-link" }) @* Assumed ProfileController, adjust if needed *@
                            <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseCourses" aria-expanded="false" aria-controls="collapseCourses">
                                <div class="sb-nav-link-icon"><i class="fas fa-book-open"></i></div>
                                Courses
                                <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                            </a>
                            <div class="collapse" id="collapseCourses" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                                <nav class="sb-sidenav-menu-nested nav">
                                    @Html.ActionLink("My Courses", "MyCourses", "UserCourses", null, new { @class = "nav-link" }) @* Assumed StudentController, adjust if needed *@
                                    @Html.ActionLink("Register Courses", "RegisterCourses", "UserCourses", null, new { @class = "nav-link" }) @* Assumed StudentController, adjust if needed *@
                                </nav>
                            </div>
                            @Html.ActionLink("Timetable", "ViewTimetable", "Timetable", null, new { @class = "nav-link" }) @* Assumed TimetableController, adjust if needed *@
                            @Html.ActionLink("Grades", "ViewGrades", "Grades", null, new { @class = "nav-link" }) @* Assumed GradesController, adjust if needed *@
                            @Html.ActionLink("Announcements", "ViewAnnouncements", "Announcements", null, new { @class = "nav-link" }) @* Assumed AnnouncementsController, adjust if needed *@
                        }

                        @* Admin-Specific Features (Visible ONLY to Admin Role) *@
                        @if (Request.IsAuthenticated && User.IsInRole("Admin"))
                        {
                            <div class="sb-sidenav-menu-heading">Admin Tools</div>
                            @Html.ActionLink("Manage TimeTable", "ManageClassSchedule", "AdminClassSchedule", null, new { @class = "nav-link" })
                           
                        }

                        <div class="sb-sidenav-menu-heading">Account</div>
                        @if (Request.IsAuthenticated)
                        {
                            @Html.ActionLink("Logout", "LogOff", "Account", null, new { @class = "nav-link" }) @* Use LogOff action from AccountController *@
                        }
                        else
                        {
                            @Html.ActionLink("Login", "Login", "Account", null, new { @class = "nav-link" })
                            @Html.ActionLink("Register", "Register", "Account", null, new { @class = "nav-link" })
                        }

                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <div class="small">Logged in as:</div>
                    @if (Request.IsAuthenticated)
                    {
                        @* Displays the username (email) of the logged-in user *@
                        <div>@User.Identity.Name</div>
                    }
                    else
                    {
                        <div>Guest</div>
                    }
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    @RenderBody()
                </div>
            </main>
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">Copyright &copy; Orchids school portal @DateTime.Now.Year</div> @* Added dynamic year *@
                        <div>
                            <a href="#">Privacy Policy</a>
                            &middot;
                            <a href="#">Terms &amp; Conditions</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
    <script src="~/ContentSource/js/Chart.min.js" crossorigin="anonymous"></script>

    <script src="~/ContentSource/js/scripts.js"></script>
    <script src="~/ContentSource/js/datatables-simple-demo.js"></script>
    <script src="~/ContentSource/assets/demo/chart-area-demo.js"></script>
    <script src="~/ContentSource/assets/demo/chart-bar-demo.js"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>